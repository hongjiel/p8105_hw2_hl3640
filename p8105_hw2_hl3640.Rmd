---
title: "Homework 2"
author: "Hongjie Liu"
output: github_document
---


Load necessary packages for homework 2.

```{r loadpackages, message = FALSE}
library(tidyverse)
library(readxl)
```


## Problem 1

Read and clean the data; retain line, station, name, station latitude / longitude, routes served, entry, vending, entrance type, and ADA compliance. Convert the entry variable from character (`YES` vs `NO`) to a logical variable.

```{r p1_tidydata}
transit_df_original = read_csv(file = "./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv")
transit_df = transit_df_original %>% 
  janitor::clean_names() %>% 
  select(line:entry, vending, ada) %>% 
  mutate(entry = recode(entry, "YES" = TRUE, "NO" = FALSE))
```

The variables that the original dataset contains are ``r names(transit_df_original)``.

First, We read the data from the csv file "NYC_Transit_Subway_Entrance_And_Exit_Data.csv". Next, we use the function `janitor::clean_names` to clean up variable names. Last, We use the functions `recode` and `mutate` to convert the entry variable from character (`YES` vs `NO`) to a logical variable.

The resulting dataset has `r nrow(transit_df)` rows and `r ncol(transit_df)` columns.

These data are still not tidy, because the values of the variables `route8` to `route11` is numeric and should be converted to character, and route number and route name are not distinct variables.

```{r p1_stnum}
stnum = transit_df %>% 
  select(station_name, line) %>% 
  distinct %>% 
  count
```

There are `r stnum` distinct stations.

```{r p1_stnum_ada}
stnum_ada = transit_df %>% 
  filter(ada == TRUE) %>% 
  select(station_name, line) %>% 
  distinct %>% 
  count
```

`r stnum_ada` stations are ADA compliant.

```{r p1_stnum_novd}
total = transit_df %>% 
  filter(vending == "NO") %>% 
  pull(entry)
  
entrynum = sum(total == TRUE)
exitnum = sum(total == FALSE)
```

The ratio of entrances to exits with no vending allow entrance is 1:`r round(exitnum/entrynum, 2)`.

Reformat data so that route number and route name are distinct variables.

```{r p1_reformat}
transit_df$route8 = as.character(transit_df$route8)
transit_df$route9 = as.character(transit_df$route9)
transit_df$route10 = as.character(transit_df$route10)
transit_df$route11 = as.character(transit_df$route11)

transit_df = transit_df %>% 
  pivot_longer(
    route1:route11,
    names_to = "route_number",
    values_to = "route_name") %>% 
  mutate(route_number = str_replace(route_number, "route", ""))
```

```{r p1_stnum_a}
stnum_a = transit_df %>% 
  filter(route_name == "A") %>% 
  select(station_name, line) %>% 
  distinct %>% 
  count

stnum_a_ada = transit_df %>% 
  filter(route_name == "A", ada == TRUE) %>% 
  select(station_name, line) %>% 
  distinct %>% 
  count
```

`r stnum_a` stations serve the A train, of which `r stnum_a_ada` are ADA compliant.


## Problem 2

Read and clean the Mr. Trash Wheel sheet:

* specify the sheet in the Excel file and to omit non-data entries (rows with notes / figures; columns containing notes) using arguments in read_excel
* use reasonable variable names
* omit rows that do not include dumpster-specific data
* round the number of sports balls to the nearest integer and converts the result to an integer variable

We assign the dataset to `mrtw_df`.

```{r p2_readtidy_mrtw}
mrtw_df = 
  read_excel(
  path = "./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
  sheet = "Mr. Trash Wheel",
  range = "A2:N533"
  ) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(sports_balls = round(sports_balls)) %>% 
  mutate(sports_balls = as.integer(sports_balls))

mrtw_df
```

We use a similar process to import, clean, and organize the data for Professor Trash Wheel and assign it to `proftw_df`. Next, we combine this with the Mr. Trash Wheel dataset `mrtw_df` to produce a single tidy dataset `tw_df`.

```{r p2_readtidy_proftw}
proftw_df = 
  read_excel(
  path = "./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
  sheet = "Professor Trash Wheel",
  range = "A2:N115"
  ) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(sports_balls = round(sports_balls)) %>% 
  mutate(sports_balls = as.integer(sports_balls)) %>% 
  mutate(trash_wheel_type = "Professor Trash Wheel")

mrtw_df = mutate(mrtw_df, trash_wheel_type = "Mr. Trash Wheel")

tw_df = bind_rows(mrtw_df, proftw_df)

tw_df
```

Here is a description of the resulting dataset `tw_df`:

* The variables of the dataset are ``r names(tw_df)``.
* Here are some values of several key variables of the dataset: some values of the variable `weight_tons` are ``r unique(tw_df$weight_tons)[1:3]``. Some values of the variable `plastic_bottles` are ``r unique(tw_df$plastic_bottles)[1:3]``.
* It has `r nrow(tw_df)` rows (number of observations) and `r ncol(tw_df)` columns.

For available data, we have:

* Professor Trash Wheel collected `r sum(pull(proftw_df, weight_tons))` tons of trash.
* Mr. Trash Wheel collected `r sum(pull(filter(mrtw_df, year == 2020), sports_balls))` sports balls in 2020.
